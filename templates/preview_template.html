<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Preview - {{ template.name }}</title>
  <style>.thumb{max-width:160px;max-height:100px;display:block;margin-top:.5rem}</style>
</head>
<body>
  <h1>Preview: {{ template.name }}</h1>

  <form method="post" enctype="multipart/form-data" id="preview-form">
    {% for f in fields %}
      {% set key = f.field_name if f.field_name else f.name %}
      <div>
        <label>{{ key }} ({{ f.field_type }})</label><br/>
        {% if (f.field_type or 'text').lower() == 'image' %}
          <input type="file" name="{{ key }}" accept="image/*" data-field="{{ key }}" class="image-input"/>
          <img id="preview-{{ key }}" class="thumb" style="display:none" />
        {% else %}
          <input type="text" name="{{ key }}" placeholder="{{ key }}" />
        {% endif %}
      </div>
    {% endfor %}
    <button type="submit">Generate Preview</button>
  </form>

  <script>
    document.querySelectorAll('.image-input').forEach(function(inp){
      inp.addEventListener('change', function(e){
        const file = e.target.files && e.target.files[0];
        const field = e.target.dataset.field;
        const img = document.getElementById('preview-' + field);
        if (!file) { img.style.display = 'none'; img.src = ''; return; }
        img.src = URL.createObjectURL(file);
        img.style.display = 'block';
      });
    });
  </script>
</body>
</html>

