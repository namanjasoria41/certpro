{% extends "base.html" %}

{% block title %}Fill Template - {{ template.name }}{% endblock %}

{% block content %}
<div class="row">
    <!-- Left: Preview -->
    <div class="col-md-8">
        <h2 class="mb-4">{{ template.name }}</h2>

        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Template Preview</h5>
                <img 
                    src="{{ url_for('static', filename='templates/' + template.image_path) }}" 
                    class="img-fluid rounded shadow-sm" 
                    alt="{{ template.name }}"
                >
            </div>
        </div>
    </div>

    <!-- Right: Form + Price -->
    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-header">
                <h5 class="mb-0">Fill Certificate Data</h5>
            </div>
            <div class="card-body">

                <!-- Pricing + Wallet Info -->
                <div class="alert alert-info mb-3">
                    <strong>Price:</strong> ₹{{ "%.2f"|format(template.price) }}<br>
                    <strong>Your Balance:</strong> ₹{{ "%.2f"|format(current_user.wallet_balance) }}
                    {% if current_user.wallet_balance < template.price %}
                        <br>
                        <span class="text-danger">⚠️ Insufficient balance!</span>
                        <a href="{{ url_for('wallet') }}" class="btn btn-sm btn-warning mt-2">
                            Add Money to Wallet
                        </a>
                    {% else %}
                        <br>
                        <span class="text-success">You have enough balance to generate this certificate.</span>
                    {% endif %}
                </div>

                <!-- Form -->
                <form method="POST" enctype="multipart/form-data">
                    {% if fields %}
                        {% for field in fields %}
                            <div class="mb-3">
                                <label for="field_{{ field.id }}" class="form-label">
                                    {{ field.field_name }}
                                    {% if field.field_type == 'text' %}
                                        <span class="badge bg-info">Text</span>
                                    {% else %}
                                        <span class="badge bg-warning text-dark">Image</span>
                                    {% endif %}
                                </label>

                                {% if field.field_type == 'text' %}
                                    <!-- TEXT FIELD -->
                                    <input 
                                        type="text"
                                        class="form-control"
                                        id="field_{{ field.id }}"
                                        name="{{ field.field_name }}"
                                        placeholder="Enter {{ field.field_name }}"
                                        required
                                    >
                                    <small class="form-text text-muted">
                                        This text will appear at the pre-configured position on the certificate.
                                    </small>

                                {% else %}
                                    <!-- IMAGE FIELD -->
                                    <input
                                        type="file"
                                        class="form-control"
                                        id="field_{{ field.id }}"
                                        name="{{ field.field_name }}"
                                        accept="image/*"
                                        required
                                    >
                                    <small class="form-text text-muted">
                                        Upload an image (e.g., logo or photo). It will be placed at the configured location.
                                        {% if field.shape == 'circle' %}
                                            Image will be cropped into a circle.
                                        {% endif %}
                                    </small>
                                {% endif %}
                            </div>
                        {% endfor %}

                        <button 
                            type="submit" 
                            class="btn btn-primary w-100"
                        >
                            Generate Certificate
                        </button>
                    {% else %}
                        <div class="alert alert-warning">
                            This template has no fields configured yet.
                        </div>
                    {% endif %}
                </form>
            </div>
        </div>

        <!-- Back link -->
        <div class="mt-3">
            <a 
                href="{{ url_for('category', category=template.category) }}" 
                class="btn btn-secondary w-100"
            >
                ← Back to {{ template.category }} Templates
            </a>
        </div>
    </div>
</div>
{% endblock %}

