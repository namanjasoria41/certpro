{% extends "base.html" %}
{% block title %}Create {{ template.name }}{% endblock %}

{% block content %}
<div class="main-container" style="max-width:600px">

  <h3 class="text-center mb-2">{{ template.name }}</h3>
  <p class="text-center text-muted">
    Fill details and upload required images
  </p>

  <form method="POST">

    {% for f in fields %}

      {% if f.field_type == "text" %}
        <div class="mb-3">
          <label class="form-label fw-semibold">
            {{ f.field_name|capitalize }}
          </label>
          <input
            class="form-control"
            name="{{ f.field_name }}"
            value="{{ request.form.get(f.field_name, '') }}"
            required
          >
        </div>
      {% endif %}

      {% if f.field_type == "image" %}
        <div class="mb-4">
          <label class="form-label fw-semibold">
            {{ f.field_name|capitalize }}
          </label>

          <div class="card p-3 text-center border-dashed">

            {% set img_path =
              session.get('preview_info', {})
                     .get('asset_map', {})
                     .get(f.field_name)
            %}

            {% if img_path %}
              <img
                src="{{ url_for('view_preview',
                  filename=img_path.split('/')[-1]) }}"
                class="img-fluid rounded mb-3"
                style="max-height:220px; object-fit:contain;"
              >

              <a
                href="{{ url_for('crop_image',
                  template_id=template.id,
                  field=f.field_name) }}"
                class="btn btn-outline-secondary btn-sm"
              >
                Re-Crop Image
              </a>
            {% else %}
              <a
                href="{{ url_for('crop_image',
                  template_id=template.id,
                  field=f.field_name) }}"
                class="btn btn-outline-primary"
              >
                Add & Crop Image
              </a>
            {% endif %}

          </div>
        </div>
      {% endif %}

    {% endfor %}

    <button type="submit" class="btn btn-primary w-100 mt-4">
      Generate Certificate â†’
    </button>

  </form>
</div>
{% endblock %}

