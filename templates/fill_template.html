<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Fill Template - {{ template.name }}</title>
  <style>
    .field-row { margin-bottom: 1rem; }
    .thumb { max-width: 160px; max-height: 100px; display:block; margin-top: .5rem; }
  </style>
</head>
<body>
  <h1>Fill: {{ template.name }}</h1>

  <!-- IMPORTANT: enctype to allow file uploads -->
  <form method="post" enctype="multipart/form-data" id="fill-form">
    {% for f in fields %}
      {% set key = f.field_name if f.field_name else f.name %}
      <div class="field-row">
        <label><strong>{{ key }}</strong> (type: {{ f.field_type }})</label><br/>

        {% if (f.field_type or 'text').lower() == 'image' %}
          <!-- file input for image fields -->
          <input type="file" name="{{ key }}" accept="image/*" data-field="{{ key }}" class="image-input" />
          <img id="preview-{{ key }}" class="thumb" src="" alt="No file chosen" style="display:none;" />
          {% if f.width and f.height %}
            <div style="font-size:0.9rem;color:#666">Suggested size: {{ f.width }}Ã—{{ f.height }}</div>
          {% endif %}
        {% else %}
          <!-- text input for text fields -->
          <input type="text" name="{{ key }}" value="" placeholder="{{ key }}" />
        {% endif %}
      </div>
    {% endfor %}

    <button type="submit">Generate</button>
  </form>

  <script>
    // Show image preview when user chooses a file
    document.querySelectorAll('.image-input').forEach(function(inp){
      inp.addEventListener('change', function(e){
        const file = e.target.files && e.target.files[0];
        const field = e.target.dataset.field;
        const img = document.getElementById('preview-' + field);
        if (!file) { img.style.display = 'none'; img.src = ''; return; }
        const url = URL.createObjectURL(file);
        img.src = url;
        img.style.display = 'block';
      });
    });
  </script>
</body>
</html>

