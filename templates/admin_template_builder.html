{% extends "base.html" %}

{% block title %}Builder — {{ template.name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/builder.css') }}">
{% endblock %}

{% block content %}

<div class="builder-container">

    <!-- Left Toolbar -->
    <div class="builder-toolbar">
        <button class="tool-btn" onclick="addText()">Text</button>
        <button class="tool-btn" onclick="triggerImageUpload()">Image</button>
        <button class="tool-btn" onclick="addRectangle()">Rect</button>
        <button class="tool-btn" onclick="addCircle()">Circle</button>
        <button class="tool-btn delete-btn" onclick="deleteSelected()">Delete</button>

        <input id="imageUploadInput" type="file" accept="image/*" style="display:none">
    </div>


    <!-- Canvas Area -->
    <div class="builder-canvas-wrapper">
        <div id="builderCanvasContainer">
            <canvas id="builderCanvas"></canvas>
        </div>

        <div class="zoom-controls">
            <button onclick="zoomOut()">−</button>
            <span id="zoomValue">100%</span>
            <button onclick="zoomIn()">+</button>
        </div>
    </div>


    <!-- Properties Panel -->
    <div class="builder-properties">

        <h5>Field Properties</h5>

        <label>Field Name</label>
        <input id="propName" onchange="updateName()">

        <label>Font Size</label>
        <input type="number" id="propFontSize" onchange="updateFontSize()">

        <label>Color</label>
        <input type="color" id="propColor" onchange="updateColor()">

        <label>Font Family</label>
        <select id="propFontFamily" onchange="updateFontFamily()">
            <option>Arial</option>
            <option>Poppins</option>
            <option>Roboto</option>
            <option>Times New Roman</option>
        </select>

        <label>Align</label>
        <select id="propAlign" onchange="updateAlign()">
            <option value="left">Left</option>
            <option value="center">Center</option>
            <option value="right">Right</option>
        </select>

        <hr>

        <button class="save-btn" onclick="saveTemplate()">Save Template</button>
    </div>

</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.2.4/fabric.min.js"></script>

<script>
    const TEMPLATE_ID = {{ template.id }};
    const TEMPLATE_URL = "{{ template_image_url }}";
    const EXISTING_FIELDS = {{ fields | tojson }};
</script>

<script src="{{ url_for('static', filename='js/builder.js') }}"></script>
{% endblock %}
